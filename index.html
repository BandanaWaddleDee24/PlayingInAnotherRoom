<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Playlist with Effects</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button, label { margin: 10px; display: block; width: 80%; max-width: 400px; }
        #playlist { list-style: none; padding: 0; }
        #playlist li { padding: 5px; cursor: pointer; border-bottom: 1px solid #ddd; }
        #playlist li.active { font-weight: bold; color: green; }
        #playerContainer { margin-top: 20px; }
    </style>
</head>
<body>

<h2>YouTube Playlist with "Other Room" Effect</h2>
<input type="text" id="youtubeLink" placeholder="Paste YouTube link and press Add">
<button onclick="addToPlaylist()">Add to Playlist</button>

<ul id="playlist"></ul>

<div id="playerContainer">
    <div id="player"></div>
</div>

<h3>Playback Controls</h3>
<button onclick="togglePlayPause()">‚ñ∂Ô∏è Play/Pause</button>
<button onclick="nextTrack()">‚è≠ Skip</button>

<h3>Background Sounds</h3>
<button onclick="toggleRain()">üåß Toggle Rain</button>
<button onclick="toggleFireplace()">üî• Toggle Fireplace</button>

<script>
    let playlist = [];
    let currentIndex = 0;
    let player;
    let audioCtx, gainNode, lowPassFilter;
    let audioElement;
    let isPlaying = false;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '300',
            width: '500',
            videoId: '',
            playerVars: { 'playsinline': 1, 'autoplay': 0, 'mute': 1 },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        setupAudioContext();
        audioElement = new Audio();
        audioElement.crossOrigin = "anonymous";
        audioElement.controls = true;
        document.body.appendChild(audioElement);
    }

    function setupAudioContext() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        gainNode = audioCtx.createGain();
        lowPassFilter = audioCtx.createBiquadFilter();
        lowPassFilter.type = "lowpass";
        lowPassFilter.frequency.setValueAtTime(500, audioCtx.currentTime);
        lowPassFilter.Q.setValueAtTime(1.5, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.7, audioCtx.currentTime);
    }

    function addToPlaylist() {
        const linkInput = document.getElementById('youtubeLink');
        const videoId = extractVideoId(linkInput.value);

        if (videoId) {
            playlist.push(videoId);
            updatePlaylistUI();
            if (playlist.length === 1) {
                playTrack(0);
            }
        } else {
            alert("Invalid YouTube link!");
        }

        linkInput.value = "";
    }

    function playTrack(index) {
        if (index < playlist.length) {
            currentIndex = index;
            player.loadVideoById(playlist[index]);
            isPlaying = true;
            updatePlaylistUI();

            // Extract audio and apply effects
            extractAudio(playlist[index]);
        }
    }

    function extractAudio(videoId) {
        audioElement.src = `https://www.youtube.com/watch?v=${videoId}`;
        audioElement.play();

        const source = audioCtx.createMediaElementSource(audioElement);
        source.connect(lowPassFilter);
        lowPassFilter.connect(gainNode);
        gainNode.connect(audioCtx.destination);
    }

    function togglePlayPause() {
        if (!player) return;

        if (isPlaying) {
            player.pauseVideo();
            audioElement.pause();
        } else {
            player.playVideo();
            audioElement.play();
        }
        isPlaying = !isPlaying;
    }

    function nextTrack() {
        if (currentIndex + 1 < playlist.length) {
            playTrack(currentIndex + 1);
        }
    }

    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
            nextTrack();
        }
    }

    function extractVideoId(url) {
        const match = url.match(/[?&]v=([^&]+)/) || url.match(/youtu\.be\/([^?]+)/);
        return match ? match[1] : null;
    }

    function updatePlaylistUI() {
        const playlistElement = document.getElementById('playlist');
        playlistElement.innerHTML = "";
        playlist.forEach((videoId, index) => {
            const listItem = document.createElement('li');
            listItem.textContent = `Video ${index + 1}`;
            listItem.classList.toggle("active", index === currentIndex);
            listItem.onclick = () => playTrack(index);
            playlistElement.appendChild(listItem);
        });
    }

    function toggleRain() {
        alert("Rain sound toggled (Not implemented yet)");
    }

    function toggleFireplace() {
        alert("Fireplace sound toggled (Not implemented yet)");
    }

</script>
</body>
</html>
