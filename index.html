<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Playlist with Effects</title>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button, label { margin: 10px; display: block; width: 80%; max-width: 400px; }
        #playlist { list-style: none; padding: 0; }
        #playlist li { padding: 5px; cursor: pointer; border-bottom: 1px solid #ddd; }
        #playlist li.active { font-weight: bold; color: green; }
    </style>
</head>
<body>

<h2>YouTube Playlist with "Other Room" Effect</h2>
<input type="text" id="youtubeLink" placeholder="Paste YouTube link and press Add">
<button onclick="addToPlaylist()">Add to Playlist</button>

<ul id="playlist"></ul>

<div id="player"></div>

<h3>Background Sounds</h3>
<label>Upload Rain Sound: <input type="file" id="rainFile" accept=".mp3, audio/*"></label>
<button onclick="toggleRain()">ðŸŒ§ Toggle Rain</button>
<input type="range" id="rainVolume" min="0" max="1" step="0.1" value="0.3" onchange="setRainVolume()"> 

<label>Upload Fireplace Sound: <input type="file" id="fireFile" accept=".mp3, audio/*"></label>
<button onclick="toggleFireplace()">ðŸ”¥ Toggle Fireplace</button>
<input type="range" id="fireplaceVolume" min="0" max="1" step="0.1" value="0.3" onchange="setFireplaceVolume()"> 

<script>
    let playlist = [];
    let currentIndex = 0;
    let player;
    let audioCtx, gainNode, lowPassFilter;
    let rainAudio, fireplaceAudio, rainGainNode, fireplaceGainNode;
    let rainPlaying = false, fireplacePlaying = false;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '0',
            width: '0',
            videoId: '',
            events: {
                'onReady': setupAudioContext,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function setupAudioContext(event) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        gainNode = audioCtx.createGain();
        lowPassFilter = audioCtx.createBiquadFilter();
        lowPassFilter.type = "lowpass";
        lowPassFilter.frequency.setValueAtTime(300, audioCtx.currentTime);
        lowPassFilter.Q.setValueAtTime(1.8, audioCtx.currentTime);
        gainNode.gain.setValueAtTime(0.35, audioCtx.currentTime);

        const audioSource = audioCtx.createMediaElementSource(event.target.getIframe());
        audioSource.connect(lowPassFilter);
        lowPassFilter.connect(gainNode);
        gainNode.connect(audioCtx.destination);
    }

    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
            nextTrack();
        }
    }

    function addToPlaylist() {
        const linkInput = document.getElementById('youtubeLink');
        const videoId = extractVideoId(linkInput.value);

        if (videoId) {
            playlist.push(videoId);
            updatePlaylistUI();
            if (playlist.length === 1) {
                playTrack(0);
            }
        } else {
            alert("Invalid YouTube link!");
        }

        linkInput.value = "";
    }

    function playTrack(index) {
        if (index < playlist.length) {
            currentIndex = index;
            player.loadVideoById(playlist[index]);
            updatePlaylistUI();
        }
    }

    function nextTrack() {
        if (currentIndex + 1 < playlist.length) {
            playTrack(currentIndex + 1);
        }
    }

    function extractVideoId(url) {
        const match = url.match(/[?&]v=([^&]+)/) || url.match(/youtu\.be\/([^?]+)/);
        return match ? match[1] : null;
    }

    function updatePlaylistUI() {
        const playlistElement = document.getElementById('playlist');
        playlistElement.innerHTML = "";
        playlist.forEach((videoId, index) => {
            const listItem = document.createElement('li');
            listItem.textContent = `Video ${index + 1}`;
            listItem.classList.toggle("active", index === currentIndex);
            listItem.onclick = () => playTrack(index);
            playlistElement.appendChild(listItem);
        });
    }

    function toggleRain() {
        if (!rainAudio) {
            rainAudio = new Audio();
            rainGainNode = audioCtx.createGain();
            setupBackgroundAudio(document.getElementById('rainFile'), rainAudio, rainGainNode);
        }
        if (rainPlaying) {
            rainAudio.pause();
        } else {
            rainAudio.play();
        }
        rainPlaying = !rainPlaying;
    }

    function toggleFireplace() {
        if (!fireplaceAudio) {
            fireplaceAudio = new Audio();
            fireplaceGainNode = audioCtx.createGain();
            setupBackgroundAudio(document.getElementById('fireFile'), fireplaceAudio, fireplaceGainNode);
        }
        if (fireplacePlaying) {
            fireplaceAudio.pause();
        } else {
            fireplaceAudio.play();
        }
        fireplacePlaying = !fireplacePlaying;
    }

    function setupBackgroundAudio(fileInput, audioRef, gainNode) {
        if (fileInput.files.length === 0) return;

        const file = fileInput.files[0];
        const objectURL = URL.createObjectURL(file);
        audioRef.src = objectURL;
        audioRef.loop = true;
        audioRef.volume = 0.3;
        gainNode.gain.setValueAtTime(audioRef.volume, audioCtx.currentTime);
    }

    function setRainVolume() {
        if (rainAudio) rainAudio.volume = document.getElementById('rainVolume').value;
    }

    function setFireplaceVolume() {
        if (fireplaceAudio) fireplaceAudio.volume = document.getElementById('fireplaceVolume').value;
    }

</script>
</body>
</html>
