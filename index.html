<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist with Background Sounds</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button, label { margin: 10px; display: block; width: 80%; max-width: 400px; }
        #playlist { list-style: none; padding: 0; }
        #playlist li { padding: 5px; cursor: pointer; border-bottom: 1px solid #ddd; }
        #playlist li.active { font-weight: bold; color: green; }
    </style>
</head>
<body>
<h2>Upload Multiple MP3s to Create a Playlist</h2>
<input type="file" id="audioFiles" accept=".mp3, audio/*" multiple>
<label>
    <input type="checkbox" id="loopPlaylist"> Loop Playlist
</label>
<button onclick="playPlaylist()">Play Playlist</button>
<button onclick="pauseAudio()">Pause</button>
<button onclick="nextTrack()">Skip to Next</button>

<h3>Background Sounds</h3>
<button onclick="toggleRain()">ðŸŒ§ Toggle Rain</button>
<input type="range" id="rainVolume" min="0" max="1" step="0.1" value="0.5" onchange="setRainVolume()"> 

<button onclick="toggleFireplace()">ðŸ”¥ Toggle Fireplace</button>
<input type="range" id="fireplaceVolume" min="0" max="1" step="0.1" value="0.5" onchange="setFireplaceVolume()"> 

<ul id="playlist"></ul>
<audio id="audio" controls></audio>

<script>
    let audioElement = document.getElementById('audio');
    let audioCtx;
    let mediaElementSource, lowPassFilter, gainNode;
    let rainGainNode, fireplaceGainNode, rainSource, fireplaceSource;
    let playlist = [];
    let currentTrackIndex = 0;
    let loopPlaylist = false;
    let rainPlaying = false;
    let fireplacePlaying = false;
    let rainAudio = new Audio("https://www.soundjay.com/nature/rain-01.mp3");
    let fireplaceAudio = new Audio("https://www.soundjay.com/fire/fire-crackle-1.mp3");

    rainAudio.loop = true;
    fireplaceAudio.loop = true;

    document.getElementById('loopPlaylist').addEventListener('change', (event) => {
        loopPlaylist = event.target.checked;
    });

    function playPlaylist() {
        const fileInput = document.getElementById('audioFiles');
        if (fileInput.files.length === 0) {
            alert("Please upload audio files!");
            return;
        }

        playlist = [];
        currentTrackIndex = 0;

        const fileList = Array.from(fileInput.files);
        const playlistElement = document.getElementById('playlist');
        playlistElement.innerHTML = '';

        fileList.forEach((file, index) => {
            const objectURL = URL.createObjectURL(file);
            playlist.push({ name: file.name, url: objectURL });

            const listItem = document.createElement('li');
            listItem.textContent = file.name;
            listItem.addEventListener('click', () => playSpecificTrack(index));
            playlistElement.appendChild(listItem);
        });

        applyEffectAndPlay(0);
    }

    function applyEffectAndPlay(index) {
        if (index < 0 || index >= playlist.length) return;

        currentTrackIndex = index;
        audioElement.src = playlist[index].url;
        audioElement.play().catch(err => console.error("Play error:", err));

        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            setupBackgroundAudio();
        } else if (audioCtx.state === "suspended") {
            audioCtx.resume();
        }

        if (mediaElementSource) {
            mediaElementSource.disconnect();
        }

        mediaElementSource = audioCtx.createMediaElementSource(audioElement);
        lowPassFilter = audioCtx.createBiquadFilter();
        lowPassFilter.type = "lowpass";
        lowPassFilter.frequency.setValueAtTime(300, audioCtx.currentTime);
        lowPassFilter.Q.setValueAtTime(1.8, audioCtx.currentTime);

        gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0.35, audioCtx.currentTime);

        mediaElementSource.connect(lowPassFilter);
        lowPassFilter.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        updatePlaylistUI();
    }

    function playSpecificTrack(index) {
        applyEffectAndPlay(index);
    }

    function nextTrack() {
        if (currentTrackIndex + 1 < playlist.length) {
            applyEffectAndPlay(currentTrackIndex + 1);
        } else if (loopPlaylist) {
            applyEffectAndPlay(0);
        }
    }

    function pauseAudio() {
        audioElement.pause();
    }

    function updatePlaylistUI() {
        const playlistItems = document.querySelectorAll("#playlist li");
        playlistItems.forEach((item, index) => {
            item.classList.toggle("active", index === currentTrackIndex);
        });
    }

    audioElement.addEventListener('ended', () => {
        nextTrack();
    });

    function setupBackgroundAudio() {
        if (!audioCtx) return;

        if (!rainGainNode) {
            rainGainNode = audioCtx.createGain();
            rainSource = audioCtx.createMediaElementSource(rainAudio);
            rainSource.connect(rainGainNode);
            rainGainNode.connect(audioCtx.destination);
        }

        if (!fireplaceGainNode) {
            fireplaceGainNode = audioCtx.createGain();
            fireplaceSource = audioCtx.createMediaElementSource(fireplaceAudio);
            fireplaceSource.connect(fireplaceGainNode);
            fireplaceGainNode.connect(audioCtx.destination);
        }
    }

    function toggleRain() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            setupBackgroundAudio();
        }

        if (rainPlaying) {
            rainAudio.pause();
        } else {
            rainAudio.play();
            rainGainNode.gain.setValueAtTime(document.getElementById('rainVolume').value, audioCtx.currentTime);
        }
        rainPlaying = !rainPlaying;
    }

    function toggleFireplace() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            setupBackgroundAudio();
        }

        if (fireplacePlaying) {
            fireplaceAudio.pause();
        } else {
            fireplaceAudio.play();
            fireplaceGainNode.gain.setValueAtTime(document.getElementById('fireplaceVolume').value, audioCtx.currentTime);
        }
        fireplacePlaying = !fireplacePlaying;
    }

    function setRainVolume() {
        if (rainGainNode) {
            rainGainNode.gain.setValueAtTime(document.getElementById('rainVolume').value, audioCtx.currentTime);
        }
    }

    function setFireplaceVolume() {
        if (fireplaceGainNode) {
            fireplaceGainNode.gain.setValueAtTime(document.getElementById('fireplaceVolume').value, audioCtx.currentTime);
        }
    }
</script>
</body>
</html>
