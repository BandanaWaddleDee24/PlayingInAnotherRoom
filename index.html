<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Background Sounds</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button, label { margin: 10px; display: block; width: 80%; max-width: 400px; }
        #playlist { list-style: none; padding: 0; }
        #playlist li { padding: 5px; cursor: pointer; border-bottom: 1px solid #ddd; }
        #playlist li.active { font-weight: bold; color: green; }
    </style>
</head>
<body>
<h2>Upload Multiple MP3s to Create a Playlist</h2>
<input type="file" id="audioFiles" accept=".mp3, audio/*" multiple>
<label>
    <input type="checkbox" id="loopPlaylist"> Loop Playlist
</label>
<button onclick="playPlaylist()">Play Playlist</button>
<button onclick="pauseAudio()">Pause</button>
<button onclick="nextTrack()">Skip to Next</button>

<h3>Custom Background Sounds</h3>
<label>Upload Rain Sound: <input type="file" id="rainFile" accept=".mp3, audio/*"></label>
<button onclick="toggleRain()">ðŸŒ§ Toggle Rain</button>
<input type="range" id="rainVolume" min="0" max="1" step="0.1" value="0.3" onchange="setRainVolume()"> 

<label>Upload Fireplace Sound: <input type="file" id="fireFile" accept=".mp3, audio/*"></label>
<button onclick="toggleFireplace()">ðŸ”¥ Toggle Fireplace</button>
<input type="range" id="fireplaceVolume" min="0" max="1" step="0.1" value="0.3" onchange="setFireplaceVolume()"> 

<ul id="playlist"></ul>
<audio id="audio" controls></audio>

<script>
    let audioElement = document.getElementById('audio');
    let audioCtx;
    let mediaElementSource, lowPassFilter, gainNode;
    let rainGainNode, fireplaceGainNode;
    let playlist = [];
    let currentTrackIndex = 0;
    let loopPlaylist = false;
    let rainPlaying = false;
    let fireplacePlaying = false;
    let rainAudio, fireplaceAudio;

    document.getElementById('loopPlaylist').addEventListener('change', (event) => {
        loopPlaylist = event.target.checked;
    });

    function initializeAudioContext() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === "suspended") {
            audioCtx.resume();
        }
    }

    function playPlaylist() {
        const fileInput = document.getElementById('audioFiles');
        if (fileInput.files.length === 0) {
            alert("Please upload audio files!");
            return;
        }

        playlist = [];
        currentTrackIndex = 0;

        const fileList = Array.from(fileInput.files);
        const playlistElement = document.getElementById('playlist');
        playlistElement.innerHTML = '';

        fileList.forEach((file, index) => {
            const objectURL = URL.createObjectURL(file);
            playlist.push({ name: file.name, url: objectURL });

            const listItem = document.createElement('li');
            listItem.textContent = file.name;
            listItem.addEventListener('click', () => playSpecificTrack(index));
            playlistElement.appendChild(listItem);
        });

        applyEffectAndPlay(0);
    }

    function applyEffectAndPlay(index) {
        initializeAudioContext();

        currentTrackIndex = index;
        audioElement.src = playlist[index].url;
        audioElement.play().catch(err => console.error("Play error:", err));

        if (mediaElementSource) {
            mediaElementSource.disconnect();
        }

        mediaElementSource = audioCtx.createMediaElementSource(audioElement);
        lowPassFilter = audioCtx.createBiquadFilter();
        lowPassFilter.type = "lowpass";
        lowPassFilter.frequency.setValueAtTime(300, audioCtx.currentTime);
        lowPassFilter.Q.setValueAtTime(1.8, audioCtx.currentTime);

        gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0.35, audioCtx.currentTime);

        mediaElementSource.connect(lowPassFilter);
        lowPassFilter.connect(gainNode);
        gainNode.connect(audioCtx.destination);

        updatePlaylistUI();
    }

    function setupCustomBackground(fileInput, audioRef, gainNode) {
        if (fileInput.files.length === 0) return;

        const file = fileInput.files[0];
        const objectURL = URL.createObjectURL(file);
        audioRef.src = objectURL;
        audioRef.loop = true;
        audioRef.volume = 0.3;
        gainNode.gain.setValueAtTime(audioRef.volume, audioCtx.currentTime);
    }

    function toggleRain() {
        initializeAudioContext();
        if (!rainAudio) {
            rainAudio = new Audio();
            rainGainNode = audioCtx.createGain();
            setupCustomBackground(document.getElementById('rainFile'), rainAudio, rainGainNode);
        }
        if (rainPlaying) {
            rainAudio.pause();
        } else {
            rainAudio.play();
        }
        rainPlaying = !rainPlaying;
    }

    function toggleFireplace() {
        initializeAudioContext();
        if (!fireplaceAudio) {
            fireplaceAudio = new Audio();
            fireplaceGainNode = audioCtx.createGain();
            setupCustomBackground(document.getElementById('fireFile'), fireplaceAudio, fireplaceGainNode);
        }
        if (fireplacePlaying) {
            fireplaceAudio.pause();
        } else {
            fireplaceAudio.play();
        }
        fireplacePlaying = !fireplacePlaying;
    }

    function setRainVolume() {
        if (rainAudio) rainAudio.volume = document.getElementById('rainVolume').value;
    }

    function setFireplaceVolume() {
        if (fireplaceAudio) fireplaceAudio.volume = document.getElementById('fireplaceVolume').value;
    }

</script>
</body>
</html>
